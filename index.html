<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Singularity | Professional AI Platform</title>
    
    <!-- PWA & SEO -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="assets/icon-192.png">

    <!-- Professional Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* --- 1. PROFESSIONAL CSS VARIABLES (CLEAN THEME) --- */
        :root {
            --primary: #2563eb; /* Trustworthy Blue */
            --secondary: #10b981; /* Nature Green */
            --dark: #1e293b;
            --light: #f8fafc;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --font: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        
        body {
            font-family: var(--font);
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* --- 2. NAVIGATION BAR --- */
        .navbar {
            background: var(--white);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .logo i { color: var(--secondary); margin-right: 8px; }
        
        .nav-links { display: flex; gap: 30px; list-style: none; }
        .nav-links a { text-decoration: none; color: var(--dark); font-weight: 500; transition: 0.3s; }
        .nav-links a:hover { color: var(--primary); }
        
        .cta-btn {
            background: var(--primary); color: white; padding: 10px 20px;
            border-radius: 6px; text-decoration: none; font-weight: 600;
            transition: 0.3s;
        }
        .cta-btn:hover { background: #1d4ed8; }

        /* --- 3. HERO SECTION --- */
        .hero {
            text-align: center; padding: 80px 20px;
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
        }
        .hero h1 { font-size: 3rem; margin-bottom: 20px; color: var(--dark); }
        .hero span { color: var(--primary); }
        .hero p { font-size: 1.2rem; color: #64748b; max-width: 700px; margin: 0 auto 40px; }

        /* --- 4. WEATHER SECTION (CARD STYLE) --- */
        .section { padding: 60px 10%; }
        .section-title { text-align: center; margin-bottom: 40px; font-size: 2rem; color: var(--dark); }
        
        .weather-card {
            background: var(--white); padding: 30px; border-radius: 12px;
            box-shadow: var(--shadow); max-width: 500px; margin: 0 auto;
            text-align: center; border-top: 4px solid var(--secondary);
        }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none; }
        .action-btn { background: var(--dark); color: white; border: none; padding: 0 20px; border-radius: 6px; cursor: pointer; }
        
        .weather-info { display: none; margin-top: 20px; }
        .temp-display { font-size: 3rem; font-weight: bold; color: var(--dark); }
        .ai-badge { background: #dcfce7; color: #166534; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; margin-top: 10px; display: inline-block; }

        /* --- 5. AI CHAT SECTION (Clean UI) --- */
        .ai-container {
            background: var(--white); border-radius: 12px; box-shadow: var(--shadow);
            overflow: hidden; max-width: 800px; margin: 0 auto; display: flex; flex-direction: column;
            height: 500px; border: 1px solid #e2e8f0;
        }
        .chat-header { background: var(--primary); color: white; padding: 15px; font-weight: 600; }
        .chat-box { flex: 1; padding: 20px; overflow-y: auto; background: #f1f5f9; display: flex; flex-direction: column; gap: 15px; }
        
        .msg { padding: 12px 16px; border-radius: 8px; max-width: 80%; font-size: 0.95rem; }
        .bot { background: var(--white); align-self: flex-start; border: 1px solid #e2e8f0; }
        .user { background: var(--primary); color: white; align-self: flex-end; }
        
        .input-area { padding: 15px; background: white; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; }

        /* --- 6. MAP SECTION --- */
        #map { height: 400px; width: 100%; border-radius: 12px; z-index: 1; }

        /* --- 7. FOOTER --- */
        footer { background: var(--dark); color: white; text-align: center; padding: 40px; margin-top: 50px; }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links { display: none; } /* Simplified for mobile */
            .hero h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <!-- NAVIGATION -->
    <nav class="navbar">
        <div class="logo"><i class="fas fa-leaf"></i> CS Hyperverse</div>
        <ul class="nav-links">
            <li><a href="#weather">Weather</a></li>
            <li><a href="#ai">AI Oracle</a></li>
            <li><a href="#map">Live Map</a></li>
        </ul>
        <a href="#contact" class="cta-btn">Join Us</a>
    </nav>

    <!-- HERO SECTION -->
    <header class="hero">
        <h1>Artificial Intelligence for <br> <span>Climate Resilience</span></h1>
        <p>A professional platform empowering farmers and communities with real-time data, AI insights, and decentralized technology.</p>
        <div style="display:flex; justify-content:center; gap:15px;">
            <button class="cta-btn" onclick="document.getElementById('weather').scrollIntoView()">Try Weather AI</button>
            <button class="cta-btn" style="background:var(--white); color:var(--dark); border:1px solid #ccc;" onclick="document.getElementById('ai').scrollIntoView()">Chat with AI</button>
        </div>
    </header>

    <!-- WEATHER SECTION -->
    <section id="weather" class="section">
        <h2 class="section-title">Real-Time Climate Analysis</h2>
        <div class="weather-card">
            <div class="search-box">
                <input type="text" id="cityInput" class="search-input" placeholder="Enter City Name (e.g., Kathmandu)">
                <button class="action-btn" onclick="getWeather()"><i class="fas fa-search"></i></button>
            </div>
            
            <!-- Default State -->
            <div id="weather-placeholder" style="color:#94a3b8;">
                <i class="fas fa-cloud-sun" style="font-size: 3rem; margin-bottom:10px;"></i>
                <p>Search a city to see AI analysis.</p>
            </div>

            <!-- Result State -->
            <div id="weatherResult" class="weather-info">
                <h3 id="cityName">KATHMANDU</h3>
                <div class="temp-display" id="tempVal">--°C</div>
                <p id="condition" style="color:#64748b;">Clear Sky</p>
                <div class="ai-badge"><i class="fas fa-robot"></i> <span id="aiAdvice">Analyzing...</span></div>
            </div>
        </div>
    </section>

    <!-- AI CHAT SECTION -->
    <section id="ai" class="section" style="background:#f1f5f9;">
        <h2 class="section-title">Climate Oracle AI</h2>
        <p style="text-align:center; margin-bottom:20px; color:#64748b;">Ask anything about farming, weather, or disaster risks.</p>
        
        <div class="ai-container">
            <div class="chat-header"><i class="fas fa-brain"></i> Professional Assistant</div>
            <div class="chat-box" id="chatBox">
                <div class="msg bot">Hello! I am your Climate Assistant. How can I help you today?</div>
            </div>
            <div class="input-area">
                <input type="text" id="userMsg" class="search-input" placeholder="Type your question..." onkeypress="handleEnter(event)">
                <button class="cta-btn" onclick="sendAiMessage()">Send</button>
            </div>
        </div>
    </section>

    <!-- MAP SECTION -->
    <section id="map" class="section">
        <h2 class="section-title">Active Monitoring Nodes</h2>
        <div id="map"></div>
    </section>

    <!-- FOOTER -->
    <footer>
        <p>&copy; 2025 Climate Singularity Hyperverse. All Rights Reserved.</p>
        <p style="font-size:0.8rem; color:#94a3b8; margin-top:10px;">Powered by Google Gemini & OpenWeatherMap</p>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- API KEYS ---
        const weatherKey = 'face30cd97a1b8feaaef06775dd83931';
        const geminiKey = 'AIzaSyDESfOpoo5WBnshXTgBJEwOrrP64j23VBM';

        // --- 1. WEATHER LOGIC (Professional) ---
        async function getWeather() {
            const city = document.getElementById('cityInput').value;
            if(!city) return alert("Please enter a city name.");

            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${weatherKey}`);
                if(!res.ok) throw new Error("City not found");
                const data = await res.json();

                // Update UI
                document.getElementById('weather-placeholder').style.display = 'none';
                document.getElementById('weatherResult').style.display = 'block';
                
                document.getElementById('cityName').innerText = data.name.toUpperCase();
                document.getElementById('tempVal').innerText = Math.round(data.main.temp) + "°C";
                document.getElementById('condition').innerText = data.weather[0].main;

                // AI Insight Logic (Simple & Reliable)
                let advice = "Conditions are normal.";
                if(data.main.temp > 30) advice = "Heat Alert: Shield sensitive crops.";
                if(data.weather[0].main.includes("Rain")) advice = "Rain Detected: Pause irrigation.";
                document.getElementById('aiAdvice').innerText = advice;

            } catch (err) {
                alert("Could not find that city. Please try again.");
            }
        }

        // --- 2. AI CHAT LOGIC (Robust) ---
        async function sendAiMessage() {
            const input = document.getElementById('userMsg');
            const text = input.value.trim();
            if(!text) return;

            // UI Update
            addChat(text, 'user');
            input.value = '';
            const loadingId = addChat("Thinking...", 'bot');

            try {
                // Call Google Gemini
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: `You are a professional agricultural expert AI for Nepal. Answer briefly (max 50 words). Question: ${text}` }]
                        }]
                    })
                });

                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;
                
                // Update Chat
                document.getElementById(loadingId).innerText = reply.replace(/\*/g, '');

            } catch (err) {
                document.getElementById(loadingId).innerText = "Connection Error. However: " + getBackupReply(text);
            }
        }

        function addChat(text, type) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.id = 'msg-' + Date.now();
            div.innerText = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
            return div.id;
        }

        function handleEnter(e) { if(e.key === 'Enter') sendAiMessage(); }

        // Backup Logic (If API fails)
        function getBackupReply(text) {
            if(text.includes('weather')) return "Please use the Weather Tool above.";
            return "I am unable to connect to the cloud, but I recommend consulting a local expert.";
        }

        // --- 3. MAP LOGIC ---
        const map = L.map('map').setView([28.3949, 84.1240], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.marker([27.7172, 85.3240]).addTo(map).bindPopup("Kathmandu HQ").openPopup();
        L.marker([28.2096, 83.9856]).addTo(map).bindPopup("Pokhara Node");

    </script>
</body>
</html>
